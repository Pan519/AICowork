# Claude-Cowork 开发指南

> **文档类型**: 开发指南
> **更新日期**: 2026-01-20
> **适用版本**: v0.1.0

---
> **@author**: Alan
> **@copyright**: Copyright © 2026
> **@created**: 2026-01-20
> **@Email**: alan@example.com
> **@license**: AGCPA v3.0
---

## 目录

- [环境准备](#环境准备)
- [本地开发](#本地开发)
- [调试技巧](#调试技巧)
- [代码规范](#代码规范)
- [测试指南](#测试指南)
- [构建发布](#构建发布)
- [常见问题](#常见问题)

---

## 环境准备

### 系统要求

- **Node.js**: 18+ 或 Bun
- **操作系统**: Windows 10/11, macOS, Linux
- **内存**: 至少 4GB RAM
- **磁盘**: 至少 2GB 可用空间

### 必需软件

1. **Node.js** 或 **Bun** (推荐)

```bash
# 使用 nvm 安装 Node.js
nvm install 18
nvm use 18

# 或安装 Bun
curl -fsSL https://bun.sh/install | bash
```

2. **Claude Code CLI**

```bash
npm install -g @anthropic-ai/claude-code
```

3. **Git**

```bash
# 克隆仓库
git clone https://github.com/DevAgentForge/Claude-Cowork.git
cd Claude-Cowork
```

### 安装依赖

```bash
# 使用 Bun（推荐）
bun install

# 或使用 npm
npm install
```

---

## 本地开发

### 启动开发服务器

```bash
bun run dev
```

这将启动：
- Vite 开发服务器 (http://localhost:5173)
- Electron 应用窗口

**目录结构**：

```
Claude-Cowork/
├── src/
│   ├── electron/      # 主进程代码
│   └── ui/            # 渲染进程代码
├── dist-electron/     # 主进程编译输出
├── dist-react/        # 前端构建输出
└── node_modules/
```

### 开发模式特性

- ✅ 热重载 (HMR)
- ✅ TypeScript 严格检查
- ✅ ESLint 实时检查
- ✅ 开发者工具
- ✅ 详细日志输出

### 环境变量

创建 `.env` 文件（可选）：

```env
# Vite 开发服务器端口
PORT=5173

# 调试模式
DEBUG=*
```

---

## 调试技巧

### 主进程调试

**方法 1: VSCode 调试**

创建 `.vscode/launch.json`：

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Main Process",
      "type": "node",
      "request": "launch",
      "cwd": "${workspaceFolder}",
      "runtimeExecutable": "${workspaceFolder}/node_modules/.bin/electron",
      "windows": {
        "runtimeExecutable": "${workspaceFolder}/node_modules/.bin/electron.cmd"
      },
      "args": ["."],
      "outputCapture": "std"
    }
  ]
}
```

**方法 2: Chrome DevTools**

1. 启动应用后，按 `Ctrl+Shift+I` (Windows/Linux) 或 `Cmd+Option+I` (macOS)
2. 切换到 "Console" 标签查看日志

### 渲染进程调试

1. 打开开发者工具
2. 切换到 "Console" 标签
3. 使用 React DevTools 查看组件状态

### 日志查看

**主进程日志位置**：

```
app.getPath("userData")/logs/
├── app.log      # 综合日志
└── error.log    # 错误日志
```

**会话日志位置**：

```
<项目目录>/.aicowork/logs/
├── session.log  # 会话日志
└── error.log    # 错误日志
```

---

## 代码规范

### TypeScript 规范

**严格模式**：

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

**类型定义**：

```typescript
// ✅ 使用 interface 定义对象结构
interface UserConfig {
  apiKey: string;
  baseURL: string;
}

// ✅ 使用 type 定义联合类型
type Status = "idle" | "running" | "error";

// ❌ 避免使用 any
function processData(data: any) { } // 避免

// ✅ 使用泛型
function processData<T>(data: T): T { }
```

### 命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 变量/函数 | camelCase | `getUserData()`, `isLoading` |
| 常量 | UPPER_SNAKE_CASE | `API_BASE_URL`, `MAX_RETRIES` |
| 类/组件 | PascalCase | `UserProfile`, `SessionManager` |
| 接口 | PascalCase | `UserData`, `ApiResponse` |
| 类型 | PascalCase | `Status`, `EventPayload` |
| 文件 | kebab-case | `user-service.ts`, `api-client.ts` |

### 注释规范

```typescript
/**
 * 函数说明
 *
 * @param param1 - 参数说明
 * @param param2 - 参数说明
 * @returns 返回值说明
 */
function functionName(param1: string, param2: number): boolean {
  // 实现
}
```

### Git 提交规范

使用 [git-commit](../../.claude/skills/git-commit/) 技能：

```bash
# 或手动提交
git commit -m "feat: 添加用户认证功能

- 实现登录/注册
- 添加 JWT 验证
- 更新文档

Co-Authored-By: Claude <noreply@anthropic.com>"
```

**提交类型**：

- `feat`: 新功能
- `fix`: Bug 修复
- `docs`: 文档变更
- `style`: 代码格式
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具

---

## 测试指南

### 手动测试

**API 连接测试**：

1. 打开设置
2. 填写 API 配置
3. 点击"测试连接"

**会话创建测试**：

1. 点击"新建任务"
2. 选择工作目录
3. 输入提示词
4. 观察响应流

**删除操作测试**：

1. 输入删除文件的提示词
2. 确认删除确认对话框弹出
3. 测试允许/拒绝操作

### 单元测试（待添加）

计划使用 Vitest：

```bash
# 安装测试依赖
bun add -D vitest @vitest/ui

# 运行测试
bun test

# 覆盖率报告
bun test --coverage
```

---

## 构建发布

### 开发构建

```bash
bun run build
```

输出：
- `dist-electron/` - 主进程编译结果
- `dist-react/` - 前端构建结果

### 打包

```bash
# Windows
bun run dist:win

# macOS Apple Silicon
bun run dist:mac-arm64

# macOS Intel
bun run dist:mac-x64

# Linux
bun run dist:linux
```

输出位置：`dist/`

### 发布流程

1. **更新版本号**

   编辑 `package.json`:
   ```json
   {
     "version": "0.2.0"
   }
   ```

2. **更新发布说明**

   编辑 `RELEASE_NOTES.md`

3. **构建所有平台**

   ```bash
   bun run dist:win
   bun run dist:mac-arm64
   bun run dist:mac-x64
   bun run dist:linux
   ```

4. **测试安装包**

   在目标平台上测试安装和运行

5. **创建 Git Tag**

   ```bash
   git tag v0.2.0
   git push origin v0.2.0
   ```

6. **发布 GitHub Release**

   上传构建好的安装包到 Releases 页面

---

## 常见问题

### Q: 编译 better-sqlite3 失败

**A**: 需要重建原生模块：

```bash
bun run rebuild
```

### Q: 找不到 Claude Code CLI

**A**: 确保已全局安装：

```bash
npm install -g @anthropic-ai/claude-code
```

### Q: 应用启动白屏

**A**: 检查 Vite 开发服务器是否启动，查看控制台错误信息。

### Q: 会话历史加载失败

**A**: 检查数据库文件权限，确保 `app.getPath("userData")` 可写。

### Q: 删除操作未被拦截

**A**: 检查 `runner.ts` 中 `permissionMode` 是否设置为 `"default"`。

### Q: 日志文件在哪里？

**A**: 运行以下命令查看：

```javascript
// 在主进程中
console.log(app.getPath("userData"));
```

---

## 附录

### 推荐工具

| 工具 | 用途 | 下载 |
|------|------|------|
| VSCode | 代码编辑器 | https://code.visualstudio.com/ |
| DevTools | 调试工具 | 内置于 Electron |
| React DevTools | React 调试 | Chrome 扩展 |

### 参考资源

- [Electron 文档](https://www.electronjs.org/docs)
- [React 文档](https://react.dev)
- [Zustand 文档](https://zustand-demo.pmnd.rs)
- [Tailwind CSS 文档](https://tailwindcss.com)
- [Claude Code 文档](https://docs.anthropic.com/en/docs/claude-code)

---

**文档版本**: 1.0.0
**最后更新**: 2026-01-20
